<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Social Media Post Adapter</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #e8d5ff 0%, #b8e6ff 50%, #f0e6d6 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            background: linear-gradient(45deg, #8e44ad, #3498db);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        .header p {
            color: #666;
            font-size: 1.1rem;
        }

        .input-section {
            background: rgba(255, 255, 255, 0.9);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .main-input {
            width: 100%;
            min-height: 120px;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 16px;
            font-family: inherit;
            resize: vertical;
            margin-bottom: 20px;
            transition: border-color 0.3s;
        }

        .main-input:focus {
            outline: none;
            border-color: #8e44ad;
        }

        .options-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .option-group {
            background: rgba(255, 255, 255, 0.7);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #ddd;
        }

        .option-group h3 {
            margin-bottom: 10px;
            color: #5d4e75;
            font-size: 1rem;
        }

        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
            flex: 1;
            min-width: 120px;
        }

        .checkbox-item input[type="checkbox"] {
            margin-right: 8px;
            transform: scale(1.1);
        }

        .checkbox-item label {
            font-size: 14px;
            cursor: pointer;
        }

        .option-description {
            font-size: 11px;
            color: #888;
            margin-left: 20px;
            font-style: italic;
            line-height: 1.2;
        }

        .checkbox-item input[type="radio"] {
            margin-right: 8px;
            transform: scale(1.1);
        }

        .generate-btn {
            background: linear-gradient(45deg, #8e44ad, #3498db);
            color: white;
            padding: 15px 40px;
            border: none;
            border-radius: 25px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            display: block;
            margin: 0 auto;
        }

        .generate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(142, 68, 173, 0.3);
        }

        .generate-btn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: none;
        }

        .loading {
            text-align: center;
            margin: 20px 0;
            display: none;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #8e44ad;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .outputs-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .blog-output {
            grid-column: 1 / -1;
            max-width: 800px;
            margin: 0 auto;
        }

        .output-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: transform 0.2s;
        }

        .output-card:hover {
            transform: translateY(-2px);
        }

        .platform-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
        }

        .platform-name {
            font-size: 1.3rem;
            font-weight: 600;
            color: #5d4e75;
        }

        .platform-icons {
            display: flex;
            gap: 10px;
        }

        .icon-instagram { background: linear-gradient(45deg, #f09433, #e6683c, #dc2743, #cc2366, #bc1888); }
        .icon-x { background: #000; }
        .icon-linkedin { background: #0077b5; }
        .icon-mastodon { background: #563acc; }
        .icon-bluesky { background: #00aaff; }
        .icon-tiktok { background: linear-gradient(45deg, #ff0050, #00f5ff); }
        .icon-blog { background: linear-gradient(45deg, #8e44ad, #f39c12); }

        .platform-icon {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .output-textarea {
            width: 100%;
            min-height: 100px;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
            resize: vertical;
            margin-bottom: 15px;
            background: rgba(255, 255, 255, 0.8);
        }

        .blog-textarea {
            min-height: 200px;
        }

        .output-actions {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .copy-btn {
            background: #27ae60;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            transition: background 0.2s;
        }

        .copy-btn:hover {
            background: #229954;
        }

        .copy-btn.copied {
            background: #8e44ad;
        }

        .output-info {
            font-size: 12px;
            color: #666;
            line-height: 1.4;
        }

        .char-count {
            font-weight: 600;
        }

        .char-count.over-limit {
            color: #e74c3c;
        }

        .char-count.optimal {
            color: #27ae60;
        }

        .donate-section {
            background: rgba(255, 255, 255, 0.9);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            margin-top: 30px;
            text-align: center;
        }

        .donate-section h3 {
            color: #5d4e75;
            margin-bottom: 10px;
        }

        .donate-section p {
            color: #666;
            margin-bottom: 15px;
        }

        .donate-btn {
            background: linear-gradient(45deg, #f39c12, #e67e22);
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 20px;
            font-size: 16px;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            transition: transform 0.2s;
        }

        .donate-btn:hover {
            transform: translateY(-1px);
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .options-grid {
                grid-template-columns: 1fr;
            }
            
            .outputs-grid {
                grid-template-columns: 1fr;
            }
            
            .checkbox-group {
                flex-direction: column;
            }
            
            .checkbox-item {
                min-width: auto;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Social Media Post Adapter</h1>
            <p>Optimize your posts for maximum engagement across all platforms</p>
        </div>

        <div class="input-section">
            <textarea 
                class="main-input" 
                id="originalPost" 
                placeholder="Enter your original post here...">
            </textarea>
            
            <div class="options-grid">
                <div class="option-group">
                    <h3>Modifications</h3>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="radio" name="characterOption" id="optimalChar" checked>
                            <label for="optimalChar">Optimal Character Count</label>
                            <div class="option-description">Restrict to ideal length for max engagement</div>
                        </div>
                        <div class="checkbox-item">
                            <input type="radio" name="characterOption" id="maxChar">
                            <label for="maxChar">Max Character Count</label>
                            <div class="option-description">Only limit to platform maximums</div>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="hashtags" checked>
                            <label for="hashtags">Add Hashtags</label>
                            <div class="option-description">Include relevant hashtags for discovery</div>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="topics" checked>
                            <label for="topics">Enhance Topics</label>
                            <div class="option-description">Expand themes & keywords for better reach</div>
                        </div>
                    </div>
                </div>
                
                <div class="option-group">
                    <h3>Tone Options</h3>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="autoAdapt" checked>
                            <label for="autoAdapt">Auto-adapt to platform</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="uplifting">
                            <label for="uplifting">Uplifting</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="professional">
                            <label for="professional">Professional</label>
                        </div>
                    </div>
                </div>
                
                <div class="option-group">
                    <h3>Additional Tones</h3>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="casual">
                            <label for="casual">Casual</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="creative">
                            <label for="creative">Creative</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="educational">
                            <label for="educational">Educational</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="spicy">
                            <label for="spicy">Irritated/Spicy</label>
                        </div>
                    </div>
                </div>
            </div>
            
            <button class="generate-btn" id="generateBtn" onclick="generatePosts()">
                Generate Adapted Posts
            </button>
        </div>

        <div class="loading" id="loadingIndicator">
            <div class="loading-spinner"></div>
            <p>Adapting your post for all platforms...</p>
        </div>

        <div class="outputs-grid" id="outputsGrid" style="display: none;">
            <div class="output-card">
                <div class="platform-header">
                    <span class="platform-name">Instagram</span>
                    <div class="platform-icons">
                        <div class="platform-icon icon-instagram"></div>
                    </div>
                </div>
                <textarea class="output-textarea" id="instagramOutput"></textarea>
                <div class="output-actions">
                    <button class="copy-btn" onclick="copyToClipboard('instagramOutput', this)">Copy</button>
                    <div class="output-info">
                        <div class="char-count" id="instagramCount">0 characters</div>
                        <div>Optimal: 125 chars, 5-9 hashtags</div>
                    </div>
                </div>
            </div>

            <div class="output-card">
                <div class="platform-header">
                    <span class="platform-name">X (Twitter)</span>
                    <div class="platform-icons">
                        <div class="platform-icon icon-x"></div>
                    </div>
                </div>
                <textarea class="output-textarea" id="xOutput"></textarea>
                <div class="output-actions">
                    <button class="copy-btn" onclick="copyToClipboard('xOutput', this)">Copy</button>
                    <div class="output-info">
                        <div class="char-count" id="xCount">0 characters</div>
                        <div>Optimal: 71-100 chars, 1-2 hashtags</div>
                    </div>
                </div>
            </div>

            <div class="output-card">
                <div class="platform-header">
                    <span class="platform-name">LinkedIn</span>
                    <div class="platform-icons">
                        <div class="platform-icon icon-linkedin"></div>
                    </div>
                </div>
                <textarea class="output-textarea" id="linkedinOutput"></textarea>
                <div class="output-actions">
                    <button class="copy-btn" onclick="copyToClipboard('linkedinOutput', this)">Copy</button>
                    <div class="output-info">
                        <div class="char-count" id="linkedinCount">0 characters</div>
                        <div>Optimal: ~100 chars, 3 hashtags</div>
                    </div>
                </div>
            </div>

            <div class="output-card">
                <div class="platform-header">
                    <span class="platform-name">Mastodon</span>
                    <div class="platform-icons">
                        <div class="platform-icon icon-mastodon"></div>
                    </div>
                </div>
                <textarea class="output-textarea" id="mastodonOutput"></textarea>
                <div class="output-actions">
                    <button class="copy-btn" onclick="copyToClipboard('mastodonOutput', this)">Copy</button>
                    <div class="output-info">
                        <div class="char-count" id="mastodonCount">0 characters</div>
                        <div>Limit: 500 chars, 3-5 hashtags</div>
                    </div>
                </div>
            </div>

            <div class="output-card">
                <div class="platform-header">
                    <span class="platform-name">BlueSky</span>
                    <div class="platform-icons">
                        <div class="platform-icon icon-bluesky"></div>
                    </div>
                </div>
                <textarea class="output-textarea" id="blueskyOutput"></textarea>
                <div class="output-actions">
                    <button class="copy-btn" onclick="copyToClipboard('blueskyOutput', this)">Copy</button>
                    <div class="output-info">
                        <div class="char-count" id="blueskyCount">0 characters</div>
                        <div>Limit: 300 chars, 2-4 hashtags</div>
                    </div>
                </div>
            </div>

            <div class="output-card">
                <div class="platform-header">
                    <span class="platform-name">TikTok</span>
                    <div class="platform-icons">
                        <div class="platform-icon icon-tiktok"></div>
                    </div>
                </div>
                <textarea class="output-textarea" id="tiktokOutput"></textarea>
                <div class="output-actions">
                    <button class="copy-btn" onclick="copyToClipboard('tiktokOutput', this)">Copy</button>
                    <div class="output-info">
                        <div class="char-count" id="tiktokCount">0 characters</div>
                        <div>Brief description, 3-5 hashtags</div>
                    </div>
                </div>
            </div>

            <div class="output-card blog-output">
                <div class="platform-header">
                    <span class="platform-name">Blog Post</span>
                    <div class="platform-icons">
                        <div class="platform-icon icon-blog"></div>
                    </div>
                </div>
                <textarea class="output-textarea blog-textarea" id="blogOutput"></textarea>
                <div class="output-actions">
                    <button class="copy-btn" onclick="copyToClipboard('blogOutput', this)">Copy</button>
                    <div class="output-info">
                        <div class="char-count" id="blogCount">0 characters</div>
                        <div>Longer format, 3-5 relevant hashtags</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="donate-section">
            <h3>Support This Tool</h3>
            <p>This tool uses the Claude API which incurs costs. Your donations help keep it running!</p>
            <a href="https://ko-fi.com/s/4dc4d3d43a" class="donate-btn" target="_blank">â˜• Buy me a coffee</a>
        </div>
    </div>

    <script>
        // Character count tracking
        function updateCharacterCount(textareaId, countId, optimalRange) {
            const textarea = document.getElementById(textareaId);
            const countElement = document.getElementById(countId);
            
            textarea.addEventListener('input', function() {
                const length = textarea.value.length;
                countElement.textContent = `${length} characters`;
                
                // Color coding based on optimal ranges
                countElement.className = 'char-count';
                if (optimalRange) {
                    if (length >= optimalRange.min && length <= optimalRange.max) {
                        countElement.classList.add('optimal');
                    } else if (length > optimalRange.max + 50) {
                        countElement.classList.add('over-limit');
                    }
                }
            });
        }

        // Initialize character counting
        document.addEventListener('DOMContentLoaded', function() {
            updateCharacterCount('instagramOutput', 'instagramCount', {min: 100, max: 125});
            updateCharacterCount('xOutput', 'xCount', {min: 71, max: 100});
            updateCharacterCount('linkedinOutput', 'linkedinCount', {min: 80, max: 100});
            updateCharacterCount('mastodonOutput', 'mastodonCount', {min: 200, max: 500});
            updateCharacterCount('blueskyOutput', 'blueskyCount', {min: 200, max: 300});
            updateCharacterCount('tiktokOutput', 'tiktokCount', {min: 50, max: 150});
            updateCharacterCount('blogOutput', 'blogCount', null);
        });

        // Copy to clipboard function
        async function copyToClipboard(textareaId, buttonElement) {
            const textarea = document.getElementById(textareaId);
            try {
                await navigator.clipboard.writeText(textarea.value);
                buttonElement.textContent = 'Copied!';
                buttonElement.classList.add('copied');
                setTimeout(() => {
                    buttonElement.textContent = 'Copy';
                    buttonElement.classList.remove('copied');
                }, 2000);
            } catch (err) {
                console.error('Failed to copy: ', err);
            }
        }

        // Get selected options
        function getSelectedOptions() {
            const options = {
                modifications: [],
                tones: [],
                characterStrategy: 'optimal'
            };

            // Character count strategy
            if (document.getElementById('maxChar').checked) {
                options.characterStrategy = 'maximum';
            }

            // Modifications
            if (document.getElementById('hashtags').checked) options.modifications.push('add relevant hashtags');
            if (document.getElementById('topics').checked) options.modifications.push('enhance topics and themes for better discoverability');

            // Tones
            if (document.getElementById('autoAdapt').checked) options.tones.push('auto-adapt to platform audience');
            if (document.getElementById('uplifting').checked) options.tones.push('uplifting');
            if (document.getElementById('professional').checked) options.tones.push('professional');
            if (document.getElementById('casual').checked) options.tones.push('casual');
            if (document.getElementById('creative').checked) options.tones.push('creative');
            if (document.getElementById('educational').checked) options.tones.push('educational');
            if (document.getElementById('spicy').checked) options.tones.push('irritated/spicy');

            return options;
        }

        // Generate posts using Claude API
        async function generatePosts() {
            const originalPost = document.getElementById('originalPost').value.trim();
            
            if (!originalPost) {
                alert('Please enter a post to adapt!');
                return;
            }

            const options = getSelectedOptions();
            const generateBtn = document.getElementById('generateBtn');
            const loadingIndicator = document.getElementById('loadingIndicator');
            const outputsGrid = document.getElementById('outputsGrid');

            // Show loading state
            generateBtn.disabled = true;
            generateBtn.textContent = 'Generating...';
            loadingIndicator.style.display = 'block';
            outputsGrid.style.display = 'none';

            try {
                // Create the prompt for Claude
                const prompt = createPrompt(originalPost, options);
                
                // Call our secure Netlify function
                const response = await fetch("/.netlify/functions/generate-posts", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify({
                        prompt: prompt
                    })
                });

                if (!response.ok) {
                    throw new Error(`API request failed: ${response.status}`);
                }

                const data = await response.json();
                
                if (!data.success) {
                    throw new Error(data.error || 'Failed to generate posts');
                }
                
                const claudeResponse = data.content;

                // Parse and populate the outputs
                parseAndPopulateOutputs(claudeResponse);

                // Show results
                outputsGrid.style.display = 'grid';
                outputsGrid.scrollIntoView({ behavior: 'smooth' });

            } catch (error) {
                console.error('Error generating posts:', error);
                alert('Error generating posts. Please check your API configuration and try again.');
            } finally {
                // Reset UI
                generateBtn.disabled = false;
                generateBtn.textContent = 'Generate Adapted Posts';
                loadingIndicator.style.display = 'none';
            }
        }

        function createPrompt(originalPost, options) {
            const characterInstructions = options.characterStrategy === 'optimal' 
                ? 'Use OPTIMAL character counts for maximum engagement'
                : 'Use up to MAXIMUM character limits for each platform';

            return `Please adapt the following social media post for different platforms.

Original post: "${originalPost}"

Character strategy: ${characterInstructions}
Selected modifications: ${options.modifications.join(', ')}
Selected tones: ${options.tones.join(', ')}

Please provide adaptations for these platforms:

1. INSTAGRAM: ${options.characterStrategy === 'optimal' ? '125 characters optimal' : '2,200 character limit'}, engaging visual-focused content
2. X/TWITTER: ${options.characterStrategy === 'optimal' ? '71-100 characters optimal' : '280 character limit'}, concise and impactful
3. LINKEDIN: ${options.characterStrategy === 'optimal' ? '100 characters optimal' : '1,300 character limit'}, professional networking tone  
4. MASTODON: ${options.characterStrategy === 'optimal' ? '200-400 characters recommended' : '500 character limit'}, community-focused, thoughtful
5. BLUESKY: ${options.characterStrategy === 'optimal' ? '200-250 characters recommended' : '300 character limit'}, conversational and authentic
6. TIKTOK: Brief engaging description for video context
7. BLOG POST: Longer-form expanded content (no character restrictions)

Format your response exactly like this:

**INSTAGRAM:**
[adapted content]

**X:**
[adapted content]

**LINKEDIN:**
[adapted content]

**MASTODON:**
[adapted content]

**BLUESKY:**
[adapted content]

**TIKTOK:**
[adapted content]

**BLOG:**
[adapted content]

Make sure each adaptation:
- Follows the ${options.characterStrategy} character strategy
- Incorporates selected modifications appropriately
- Matches the platform's audience and tone
- Maintains the core message while optimizing for platform-specific engagement`;
        }

        function parseAndPopulateOutputs(claudeResponse) {
            try {
                // Parse the structured response
                const platforms = {
                    'INSTAGRAM:': 'instagramOutput',
                    'X:': 'xOutput', 
                    'LINKEDIN:': 'linkedinOutput',
                    'MASTODON:': 'mastodonOutput',
                    'BLUESKY:': 'blueskyOutput',
                    'TIKTOK:': 'tiktokOutput',
                    'BLOG:': 'blogOutput'
                };

                const lines = claudeResponse.split('\n');
                let currentPlatform = null;
                let currentContent = [];

                for (let line of lines) {
                    line = line.trim();
                    
                    // Check if this line starts a new platform section
                    let foundPlatform = null;
                    for (let platform in platforms) {
                        if (line.includes('**' + platform) || line.includes(platform)) {
                            foundPlatform = platform;
                            break;
                        }
                    }

                    if (foundPlatform) {
                        // Save previous platform content
                        if (currentPlatform && currentContent.length > 0) {
                            const textareaId = platforms[currentPlatform];
                            const textarea = document.getElementById(textareaId);
                            if (textarea) {
                                textarea.value = currentContent.join('\n').trim();
                                // Trigger character count update
                                textarea.dispatchEvent(new Event('input'));
                            }
                        }
                        
                        // Start new platform
                        currentPlatform = foundPlatform;
                        currentContent = [];
                    } else if (currentPlatform && line && !line.includes('**')) {
                        currentContent.push(line);
                    }
                }

                // Don't forget the last platform
                if (currentPlatform && currentContent.length > 0) {
                    const textareaId = platforms[currentPlatform];
                    const textarea = document.getElementById(textareaId);
                    if (textarea) {
                        textarea.value = currentContent.join('\n').trim();
                        // Trigger character count update
                        textarea.dispatchEvent(new Event('input'));
                    }
                }

            } catch (error) {
                console.error('Error parsing Claude response:', error);
                
                // Fallback: just put the raw response in the first textarea
                document.getElementById('instagramOutput').value = claudeResponse;
            }
        }
    </script>
</body>
</html>